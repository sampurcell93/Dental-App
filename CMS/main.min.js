
$(document).ready(function(){var index_count=0;$(".fUpload, .help").on("click",function(e){var pair="#"+$(this).attr("data-rel");e.preventDefault();$(pair).fadeToggle("fast").addClass("inRange");$("#lander_wrap").addClass("blur");});$("#addHeader").on("click",function(){$(".content").append("<div id='wrap"+index_count+"'></div>");var wrapper=$("#wrap"+index_count);var toAppend="";toAppend+=newContent(index_count)+newConsole(index_count)+newRemove(index_count);wrapper.append(toAppend);wrapper.height(530);$("html, body").animate({scrollTop:$(document).height()},"slow");index_count++;});$("[class*=create]").live("click",function(){var pair=$(this).parent().attr("data-rel");$("#"+pair).append($(this).attr("data-content"))
console.log($("#"+pair).html());});$(".remove").live("click",function(){var pair=$(this).attr("data-rel");$("#wrap"+pair).empty().remove();$(this).remove();index_count--;});$("#preview").live("click",function(){$("#previewContent").empty();$("#previewBox").show();var title="<h1>"+$("#node_title").val()+"</h1>";$("#previewContent").html(title);for(var i=0;i<$(".infoInput").length;i++){var curr=$("#previewContent").html();var header="<h2>"+$("#head"+i).val()+"</h2>\n";var text=$("#text"+i).html()+"<br />";if(header&&title&&text){$("#previewContent").html(curr+header+text);}}});$(".close").live("click",function(){$(this).parent().hide().removeClass("inRange");$("#lander_wrap").removeClass("blur");});$(".submitInfo").live("click",function(e){aggregate();});$("#showPreview").on("click",function(){$("#dbPreview").slideToggle();var show="See what you created, as it exists in our databases.";var hide="Hide"
if($(this).text()==show){$(this).text(hide);}
else{$(this).text(show);}});var browseHierarchy=$("#browseHierarchy");var makeHierarchy=$("#makeHierarchy");$("#existingHierarchy, #newHierarchy").on("click",function(){makeHierarchyBox($(this).attr("rel"));});$(".hierarchy").delegate("span","click",function(){var appendString="<div class='block bottom'>";var $this=$(this);var pair=$("#"+$this.closest(".hierarchy").attr("id"));$this.addClass("selected").siblings().removeClass("selected");if($this.closest(".block").index()<pair.find(".block").length){var parent_index=$this.parent().index(),num_blocks_before=pair.find(".block").length,num_blocks_after;$this.closest(".hierarchy").find(".block:gt("+parent_index+")").remove();num_blocks_after=browseHierarchy.find(".block").length;}
$.getJSON('existinghierarchy.php?id='+$this.attr("id")+"&condition="+$this.attr("data-condition"),function(data){if(!jQuery.isEmptyObject(data)&&data.children[0]!=-1){for(var i=0;i<data.children.length;i++){appendString+="<span id='"+data.children[i][0]+"' data-condition='"+data.name+"'>"+data.children[i][1]+"</span>";}
appendString+="</div>";pair.append(appendString);}
else{pair.append("<p class='block'>This node has no children, and no data associated with it. <a class='cursor' id='make'>Add Information</a></p>");}});});$("#make").live("click",function(){$("#addContent").slideDown("fast");makeTitle();});$(".addNode").live("click",function(){var newSpan="<span contentEditable='true' class='newNode'></span>";var $this=$(this);$(newSpan).appendTo($this.closest(".block"));});$(".removeAppendix").on("click",function(){$(this).parent().html("loading....").load("remove_appendix.php?id="+$(this).attr("rel"));$(this).closest(".wrap").remove();});});function newContent(the_index){var header="<hr /><input type='text' id='head"+the_index+"' placeholder='Put a header here.' />";var text="<div class='infoInput' contentEditable='true' id='text"+the_index+"' placeholder='This is where the content for this header goes.'></div>";return header+text;}
function newConsole(the_index){var bold="<li data-content='<strong>Bold text here</strong>' class='createBold' >Bold</li>";var list="<li data-content='<ul>\n<li>List item</li>\n<li>List item</li>\n<li>List item</li>\n</ul>' class='createList'>List</li>";var link="<li data-content='<a href=\"http://yourlinkhere.com\" >Name your link</a>' class='createLink'>Link</li>";var subheader="<li class='subList'>Header<ul data-rel='text"+the_index+"' id='H4s'><li class='createBig' data-content='<h3>Header</h3>'>Big</li><li class='createSmall' data-content='<h4>Header</h4>'>Small</li></ul></li>";var media="<li>Media</li>";var console="<ul class='console' id='console"+the_index+"' data-rel='text"+the_index+"'>"
console+=list+subheader+link+bold+media+"</ul>";return console;}
function newRemove(the_index){return"<a class='button remove' data-rel='"+the_index+"' >Remove This</a>";}
function aggregate(){var headers=[];var textboxes=[];var compiledHeaders="";var compiledText="";for(var i=0;i<$("[id*=head]").length-1;i++){headers[i]=$("#head"+i).val();textboxes[i]=$("#text"+i).html();console.log(textboxes[i]);compiledHeaders+=headers[i]+"| ";compiledText+=textboxes[i]+"| ";}
compiledText=compiledText.substring(0,compiledText.length-2);compiledHeaders=compiledHeaders.substring(0,compiledHeaders.length-2);$("#passheads").val(compiledHeaders);$("#passtext").val(compiledText);$("#passtitle").attr("value",$("#node_title").val());}
function insertAtCaret(areaId,text){var txtarea=document.getElementById(areaId);var scrollPos=txtarea.scrollTop;var strPos=0;var br=((txtarea.selectionStart||txtarea.selectionStart=='0')?"ff":(document.selection?"ie":false));if(br=="ie"){txtarea.focus();var range=document.selection.createRange();range.moveStart('character',-txtarea.value.length);strPos=range.text.length;}
else if(br=="ff")strPos=txtarea.selectionStart;var front=(txtarea.value).substring(0,strPos);var back=(txtarea.value).substring(strPos,txtarea.value.length);txtarea.value=front+text+back;strPos=strPos+text.length;if(br=="ie"){txtarea.focus();var range=document.selection.createRange();range.moveStart('character',-txtarea.value.length);range.moveStart('character',strPos);range.moveEnd('character',0);range.select();}
else if(br=="ff"){txtarea.selectionStart=strPos;txtarea.selectionEnd=strPos;txtarea.focus();}
txtarea.scrollTop=scrollPos;}
$(window).scroll(function(e){$el=$('#addHeader');if($(this).scrollTop()>260&&!$el.hasClass("fixed")){$('#addHeader').addClass("fixed");}
if($(this).scrollTop()<260&&$el.hasClass("fixed")){$el.removeClass("fixed");}});function makeHierarchyBox(rel){var $update=$(rel);var appendString="<div class='block'>";$.getJSON('existinghierarchy.php',function(data){for(var i=0;i<data.conditions.length;i++){appendString+="<span id='-1' data-condition='"+data.conditions[i].name+"'>"+data.conditions[i].name+"</span>";}
if(rel=="#makeHierarchy"){appendString+="<div class='addNode'>+</div>";}
appendString+="</div>";$update.append(appendString);$update.show();});}